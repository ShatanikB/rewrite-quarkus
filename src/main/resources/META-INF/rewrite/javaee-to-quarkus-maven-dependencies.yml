#
# Copyright 2024 the original author or authors.
# <p>
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
# <p>
# https://www.apache.org/licenses/LICENSE-2.0
# <p>
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.quarkus.quarkus2.JavaEEtoQuarkus2MavenDependencyMigration
displayName: Migrate JavaEE Maven and Gradle Dependencies to Quarkus 2
description: Upgrade Standard JavaEE dependencies to Quarkus 2 dependencies.
recipeList:
  # Add Quarkus BOM
  - org.openrewrite.maven.AddManagedDependency:
      groupId: io.quarkus.platform
      artifactId: quarkus-bom
      version: '2.x'
      type: pom
      scope: import

  # Add Basic Quarkus Extensions
  - org.openrewrite.java.dependencies.AddDependency:
      groupId: io.quarkus
      artifactId: quarkus-arc
  - org.openrewrite.java.dependencies.AddDependency:
      groupId: io.quarkus
      artifactId: quarkus-resteasy
  - org.openrewrite.java.dependencies.AddDependency:
      groupId: io.quarkus
      artifactId: quarkus-resteasy-jackson
  - org.openrewrite.java.dependencies.AddDependency:
      groupId: io.quarkus
      artifactId: quarkus-undertow
  - org.openrewrite.java.dependencies.AddDependency:
      groupId: io.quarkus
      artifactId: quarkus-hibernate-orm
  - org.openrewrite.java.dependencies.AddDependency:
      groupId: io.quarkus
      artifactId: quarkus-jdbc-h2
  - org.openrewrite.java.dependencies.AddDependency:
      groupId: io.quarkus
      artifactId: quarkus-junit5
      scope: test
  - org.openrewrite.java.dependencies.AddDependency:
      groupId: io.rest-assured
      artifactId: rest-assured
      scope: test

  # Add Maven Plugins
  - org.openrewrite.maven.AddPlugin:
      groupId: io.quarkus.platform
      artifactId: quarkus-maven-plugin
      version: '2.16.12.Final'
      executions: <executions><execution><goals><goal>build</goal><goal>generate-code</goal><goal>generate-code-tests</goal></goals></execution></executions>
  - org.openrewrite.maven.AddPlugin:
      groupId: org.apache.maven.plugins
      artifactId: maven-compiler-plugin
      version: '3.10.1'
      configuration: <configuration><compilerArgs><arg>-parameters</arg></compilerArgs></configuration>
  - org.openrewrite.maven.AddPlugin:
      groupId: org.apache.maven.plugins
      artifactId: maven-surefire-plugin
      version: '3.0.0-M7'
      configuration: <configuration><systemPropertyVariables><java.util.logging.manager>org.jboss.logmanager.LogManager</java.util.logging.manager><maven.home>${maven.home}</maven.home></systemPropertyVariables></configuration>
  - org.openrewrite.maven.AddPlugin:
      groupId: org.apache.maven.plugins
      artifactId: maven-failsafe-plugin
      version: '3.0.0-M7'
      executions: <executions><execution><goals><goal>integration-test</goal><goal>verify</goal></goals></execution></executions>
      configuration: <configuration><systemPropertyVariables><native.image.path>${project.build.directory}/${project.build.finalName}-runner</native.image.path><java.util.logging.manager>org.jboss.logmanager.LogManager</java.util.logging.manager><maven.home>${maven.home}</maven.home></systemPropertyVariables></configuration>
  - org.openrewrite.maven.AddProfile:
      id: native
      activation: <activation><property><name>native</name></property></activation>
      properties: <properties><skipITs>false</skipITs><quarkus.package.type>native</quarkus.package.type></properties>
  - org.openrewrite.quarkus.ConfigureQuarkusMavenPluginWithReasonableDefaults
  - org.openrewrite.maven.BestPractices

  # Remove JavaEE dependencies
  - org.openrewrite.java.dependencies.RemoveDependency:
      groupId: javax*
      artifactId: javaee-api
  - org.openrewrite.java.dependencies.RemoveDependency:
      groupId: javax*
      artifactId: cdi-api
  - org.openrewrite.java.dependencies.RemoveDependency:
      groupId: javax*
      artifactId: javax*

  # Prep for Java 11 upgrade
  - org.openrewrite.maven.AddProperty:
      key: maven.compiler.source
      value: 11
  - org.openrewrite.maven.AddProperty:
      key: maven.compiler.target
      value: 11
  - org.openrewrite.maven.ChangePackaging:
      groupId: '*'
      artifactId: '*'
      packaging: jar